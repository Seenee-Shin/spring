<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="boardMapper">

	<!-- Board VO resultMap -->
	<resultMap type="Board" id="boardRm">
		<id property="boardNo" column="BOARD_NO"/> <!-- PK -->
		<result property="boardTitle"   column="BOARD_TITLE" />
		<result property="boardContent" column="BOARD_CONTENT" />
		<result property="createDate"   column="CREATE_DT" />
		<result property="modifyDate"   column="MODIFY_DT" />
		<result property="readCount"    column="READ_COUNT" />
		<result property="memberNo" 	column="MEMBER_NO" />
		<result property="statusCode"   column="STATUS_CD" />
		<result property="categoryCode" column="CATEGORY_CD" />
		<result property="memberName" 	column="MEMBER_NM" />
		<result property="categoryName" column="CATEGORY_NM" />
		<result property="statusName" 	column="STATUS_NM" />
		
		<collection property="imgList" column="BOARD_NO"
					javaType="java.util.ArrayList" ofType="BoardImage" select="selectBoardImageList"/>
	</resultMap>
	
	
	
	<!-- 특정 게시글 이미지 정보 조회   -->
	<select id="selectBoardImageList" resultMap="boardImageRm">
		SELECT * FROM BOARD_IMG
		WHERE BOARD_NO = #{boardNo}
		ORDER BY IMG_LEVEL	
	</select>
	
	<!-- BoardImage VO  -->
	<resultMap type="BoardImage" id="boardImageRm">
		<id property="imgNo" column="IMG_NO"/>
		<result property="imgPath" column="IMG_PATH"/>
		<result property="imgName" column="IMG_NM"/>
		<result property="imgOriginal" column="IMG_ORIGINAL"/>
		<result property="imgLevel" column="IMG_LEVEL"/>
		<result property="boardNo" column="BOARD_NO"/>
		
		
	</resultMap>
	

	
	<!-- 게시글 전제 개수 -->
	<select id="getListCount" resultType="_int">
		SELECT COUNT(*) FROM BOARD WHERE STATUS_CD != 4
	</select>
	
	
	<!-- 게시글 목록 조회 
	
	 	 <![CDATA[SQL문 작성]]> : 내부에 작성된 태그문자를 문자자체로 인식시킴
	 	 -> &lt; / &gt; 도 사용가능하나 cdata타입 사용권장
	 -->
	<select id="selectBoardList" resultMap="boardRm">
		<![CDATA[
		SELECT BOARD_NO, BOARD_TITLE, READ_COUNT,
    		CASE WHEN SYSDATE - CREATE_DT < 1
         	THEN TO_CHAR(CREATE_DT, 'HH:MI')     
         	ELSE TO_CHAR(CREATE_DT, 'YYYY-MM-DD')
    		END "CREATE_DT",
   		 MEMBER_NO, MEMBER_NM, STATUS_CD, STATUS_NM, CATEGORY_CD, CATEGORY_NM
		FROM BOARD -- STATUS_CD
		JOIN MEMBER USING(MEMBER_NO) -- STATUS_CD
		JOIN STATUS ON(BOARD.STATUS_CD = STATUS.STATUS_CD)
		JOIN CATEGORY USING(CATEGORY_CD)
		WHERE STATUS_CD != 4
		ORDER BY BOARD_NO DESC
		]]>
	</select>
	
	<!-- 게시글 상세조회 -->
	<select id="selectBoard" resultMap="boardRm">
		  SELECT BOARD_NO, BOARD_TITLE, BOARD_CONTENT, MEMBER_NO, MEMBER_NM,
		          TO_CHAR(CREATE_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"' ) CREATE_DT,
		          TO_CHAR(MODIFY_DT, 'YYYY"년" MM"월" DD"일" HH24"시" MI"분" SS"초"' ) MODIFY_DT,
		          CATEGORY_CD, CATEGORY_NM, READ_COUNT, STATUS_NM
	      FROM BOARD B
	      JOIN MEMBER USING(MEMBER_NO)
	      JOIN STATUS S ON(B.STATUS_CD = S.STATUS_CD)
	      JOIN CATEGORY USING(CATEGORY_CD)
	      WHERE BOARD_NO = ${boardNo}
	      AND STATUS_CD != 4
	</select>
</mapper>
